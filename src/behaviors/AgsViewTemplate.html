<link rel="import" href="AgsTemplate.html">

<script>

  (function (augeas){

    /**
     * This behavior turns an element into a template used to render read-only views of provided objects
     *
     * @polymerBehavior Augeas.AgsViewTemplate */
    var agsViewTemplate = {
      properties: {
        /**
         * The name of variable which will be available for binding with the template
         */
        as: {
          type: String,
          value: 'model'
        },
        /**
         * If truthy, the name is set as attribute on the instance of an `<ags-view>`
         * when this template is used to render the object
         */
        name: {
          type: String,
          value: ''
        },
        /**
         * If truthy, it constrains the values its `<template>` will render to only those
         * that are values of specific properties (predicates)
         */
        predicate: {
          type: String,
          value: null
        },
        /**
         * If truthy, it constraints the applicable usage of this element to only `<ags-view>` instances
         * with matching scope property.
         */
        scope: {
          type: String,
          value: ''
        },
        /**
         * If truthy, it will be used as `@context` in JSON-LD API to compact the object before
         * binding with the rendered template
         */
        compactWith: Object
      },

      /**
       * Determines whether the provided `object`, `predicate` and `scope` allow the `object`
       * to be rendered by this instance's template.
       */
      isMatch: function(object, predicate, scope) {
        var objectMatches, predicateMatches, isScopeMatch;

        objectMatches = this.objectMatches(object);
        predicateMatches = this.predicateMatches(predicate);
        isScopeMatch = scopeMatches.call(this, scope);

        return objectMatches && predicateMatches && isScopeMatch;
      },

      /**
       * Determines whether the object can be displayed by this instance's template
       *
       * @param object
       * @returns {boolean}
       */
      objectMatches: function(object) {
        return true;
      },

      /**
       * Determines whether this predicate (property) can be displayed by this instance's template.
       *
       * In other words, it checks whether objects attached to that property can be displayed
       *
       * @param predicate
       * @returns {boolean}
       */
      predicateMatches: function(predicate) {
        if(this.predicate) {
          return this.predicate === predicate;
        }

        return true;
      },

      _kind: function () {
        return 'view';
      }
    };

    augeas.AgsViewTemplate = [ augeas.AgsTemplate, agsViewTemplate ];

    function scopeMatches(scope) {
      return this.scope == scope;
    }

  })(window.Augeas || (window.Augeas = {}));

</script>