<script>
  (function (augeas) {

    /** @polymerBehavior Augeas.TemplateStamper */
    var templateStamper = {

      /**
       * Stamps the given `ags-template` into the `ags-view`
       *
       * @param agsView the view element
       * @param agsTemplate the ags-template element
       * @param object the model bound with the template
       */
      getStamped: function (agsView, agsTemplate, object) {
        var template = agsTemplate.template;

        this.templatize(template);

        if (template.compactWith) {
          return jsonld.compact(object, template.compactWith)
            .then(function(compacted ) {
              stamp(this, agsView, agsTemplate, compacted);
            }.bind(this));
        } else {
          return Promise.resolve(stamp(this, agsView, agsTemplate, object));
        }
      }
    };

    augeas.TemplateStamper = [ Polymer.Templatizer, templateStamper ];

    function stamp(templatizer, objectView, agsTemplate, object) {
      var stampedModel = { };
      stampedModel[agsTemplate.as] = object;
      stampedModel.predicate = this.predicate;
      stampedModel.params = objectView.params;

      return templatizer.stamp(stampedModel).root;
    }

  })(window.Augeas || (window.Augeas = {}));
</script>