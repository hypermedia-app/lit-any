<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ags-form tests</title>
    <script src="../bower_components/webcomponentsjs/webcomponents.min.js"></script>
    <link rel="import" href="../bower_components/polymer/polymer.html"/>
    <link rel="import" href="../bower_components/polymer-ts/polymer-ts.html"/>
    <script src="../bower_components/web-component-tester/browser.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsonld/0.4.11/jsonld.min.js"></script>
    <link rel="import" href="../augeas.html"/>
    <script src="_TestHelpers.js"></script>
</head>
<body>

<test-fixture id="no-field-templates">
    <template>
        <ags-field></ags-field>
    </template>
</test-fixture>

<test-fixture id="field-with-property">
    <template>
        <ags-field property="http://www.markus-lanthaler.com/hydra/api-demo/vocab#Issue/title"></ags-field>
    </template>
</test-fixture>

<test-fixture id="field-template-for-property">
    <template>
        <template is="ags-field-property-template" property="http://www.markus-lanthaler.com/hydra/api-demo/vocab#Issue/description">
            <textarea value="{{value::input}}"></textarea>
        </template>

        <ags-field property="http://www.markus-lanthaler.com/hydra/api-demo/vocab#Issue/title"></ags-field>
    </template>
</test-fixture>

<script>

    var subject;

    describe('ags-field', function () {

        describe('with property not set', function() {

            beforeEach(function(){
                subject = fixture('no-field-templates');
            });

            it('should render no field', function (done) {
                flush(function () {
                    var children = subject.querySelectorAll('input');

                    assert.equal(children.length, 0);
                    done();
                });
            });
        });

        describe('with no matching template', function () {

            beforeEach(function(){
                subject = fixture('field-with-property');
            });

            it('should render a text input', function (done) {
                flush(function () {
                    var field = subject.querySelector('input');

                    assert.equal(field.constructor, HTMLInputElement);
                    assert.equal(field.type, 'text');
                    done();
                });
            });

            it('should set value property when input value is set', function (done) {

                flush(function () {
                    var input = subject.querySelector('input');

                    setInputValue(input, 'I wrote this');

                    assert.equal(subject.value, 'I wrote this');
                    done();
                });
            });
        });

        describe('with template matched by property', function() {
            beforeEach(function(){
                subject = fixture('field-template-for-property')[1];
            });

            it('should render the template', function(done) {
                flush(function() {
                    var textarea = subject.$$('textarea');

                    assert.isNotNull(textarea);
                    done();
                });
            });
        });
    });

</script>
</body>
</html>