{"version":3,"file":"augeas.js","sources":["../src/template-registry/TemplateSelector.js","../src/template-registry/TemplateSelectorBuilder.js","../src/template-registry/template-registry.js","../src/template-registry/index.js","../src/elements/ags-view.js"],"sourcesContent":["export default class TemplateSelector {\n    constructor() {\n        this.name = '';\n        this._matchers = [];\n    }\n\n    matches(criteria) {\n        return this._matchers.every(matcher => matcher.call(matcher, criteria));\n    }\n}\n","import TemplateSelector from './TemplateSelector';\n\nexport default class TemplateSelectorBuilder {\n    constructor(registry) {\n        this._registry = registry;\n        this._selector = new TemplateSelector();\n    }\n\n    value(valueMatcher) {\n        this._selector._matchers.push(contraint => valueMatcher(contraint.value));\n\n        return this;\n    }\n\n    scope(scopeMatcher) {\n        this._selector._matchers.push(contraint => scopeMatcher(contraint.scope));\n\n        return this;\n    }\n\n    renders(fn) {\n        this._registry.push(this._selector, fn);\n        return this._registry;\n    }\n}\n","import TemplateSelectorBuilder from './TemplateSelectorBuilder';\n\nexport default class TemplateRegistry {\n    constructor() {\n        this._templates = [];\n    }\n\n    get count() {\n        return this._templates.length;\n    }\n\n    /**\n     *\n     * @returns {TemplateSelectorBuilder}\n     */\n    get when() {\n        return new TemplateSelectorBuilder(this);\n    }\n\n    getTemplate(value, scope) {\n        const selectedTemplate = this._templates.find(template =>\n            template.selector.matches(value, scope));\n\n        return {\n            render: selectedTemplate.templateFunc,\n            name: selectedTemplate.name || null,\n        };\n    }\n\n    push(selector, templateFuncOrResult, name) {\n        let templateFunc = templateFuncOrResult;\n\n        if (typeof templateFunc !== 'function') {\n            templateFunc = () => templateFuncOrResult;\n        }\n\n        this._templates.push({\n            selector,\n            templateFunc,\n            name,\n        });\n    }\n}\n","import TemplateRegistry from './template-registry';\n\nexport const ViewTemplates = new TemplateRegistry();\nexport const FormTemplates = new TemplateRegistry();\n","import { render } from 'lit-html/lib/lit-extended';\nimport { PropertyAccessors } from '@polymer/polymer/lib/mixins/property-accessors';\nimport { html } from 'lit-html';\nimport { ViewTemplates } from '../template-registry';\n\nfunction recurseTemplates(agsView, root, inheritedScope) {\n    return (value, currentScope) => {\n        let templateResult;\n        const scope = currentScope || inheritedScope;\n        const template = ViewTemplates.getTemplate(\n            value,\n            scope,\n        );\n\n        if (template) {\n            if (root && template.name) {\n                agsView.setAttribute('data-template', template.name);\n            }\n\n            templateResult = template.render(recurseTemplates(agsView, false, scope), value);\n        } else if (agsView.ignoreMissing) {\n            templateResult = '';\n        } else {\n            templateResult = html`Template not found`;\n            console.warn('Template not found for', value);\n        }\n\n        return templateResult;\n    };\n}\n\nexport default class AgsView extends PropertyAccessors(HTMLElement) {\n    constructor() {\n        super();\n\n        this.templateScope = null;\n        this.value = null;\n        this.ignoreMissing = false;\n    }\n\n    static get observedAttributes() {\n        return [\n            'value',\n            'templateScope',\n            'ignoreMissing',\n        ];\n    }\n\n    connectedCallback() {\n        this._enableProperties();\n    }\n\n    _propertiesChanged() {\n        this._render();\n    }\n\n    _render() {\n        if (this.value) {\n            if (!this.shadowRoot) {\n                this.attachShadow({ mode: 'open' });\n            }\n\n            const templateFunc = recurseTemplates(this, true, this.templateScope);\n\n            render(templateFunc(this.value), this.shadowRoot);\n        }\n\n        this.dispatchEvent(new CustomEvent('ags-render'));\n    }\n}\n\nAgsView.createPropertiesForAttributes();\n\nwindow.customElements.define('ags-view', AgsView);\n"],"names":["TemplateSelector","name","_matchers","criteria","every","matcher","call","TemplateSelectorBuilder","registry","_registry","_selector","valueMatcher","push","contraint","value","scopeMatcher","scope","fn","TemplateRegistry","_templates","count","length","when","selectedTemplate","find","template","selector","matches","templateFunc","templateFuncOrResult","ViewTemplates","FormTemplates","recurseTemplates","agsView","root","inheritedScope","currentScope","templateResult","getTemplate","setAttribute","render","ignoreMissing","html","warn","AgsView","PropertyAccessors","HTMLElement","templateScope","observedAttributes","_enableProperties","_render","shadowRoot","attachShadow","mode","dispatchEvent","CustomEvent","createPropertiesForAttributes","window","customElements","define"],"mappings":"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"}